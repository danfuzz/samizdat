# Copyright 2013 the Samizdat Authors (Dan Bornstein et alia).
# Licensed AS IS and WITHOUT WARRANTY under the Apache License,
# Version 2.0. Details: <http://www.apache.org/licenses/LICENSE-2.0>

def CommandLine = moduleUse({name: ["core", "CommandLine"]});
def Io1 = moduleUse({name: ["core", "Io1"]});

fn main(selfPath, rawArgs*) {
    Io1::note("\
        Starting: \%q(selfPath)
        Raw args: \%q(rawArgs)\n");

    def args = CommandLine::parseArgs(rawArgs);

    Io1::note("Args:     \%q(args)\n");

    def sourceFile = args::args[0];
    def targetFile = args::options::output;
    def modeName = args::options::mode | "fake";

    def sourcePath = Io1::pathFromFlat(sourceFile);
    def targetPath = Io1::pathFromFlat(targetFile);
    def modeModule = moduleUse({name: [modeName]});

    Io1::note("\
        Source:   \%q(sourcePath)
        Target:   \%q(targetPath)
        Compiler: \%q(modeName)\n");

    modeModule::compile(sourcePath, targetPath);
};

<> {main}
