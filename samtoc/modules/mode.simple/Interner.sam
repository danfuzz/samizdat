## Copyright 2013-2014 the Samizdat Authors (Dan Bornstein et alia).
## Licensed AS IS and WITHOUT WARRANTY under the Apache License,
## Version 2.0. Details: <http://www.apache.org/licenses/LICENSE-2.0>


##
## Exported Definitions
##

export fn makeInterner() {
    var values = {};
    return @Interner{values: (var values)}
};

export fn intern(this, value) {
    def box = this::values;
    def values = box*;

    if (def already = values[value]) {
        return already;
    };

    def result = #values;

    box* := {values*, (value): result};
    return result
};

export fn get_interns(this) {
    def map = this::values*;
    def boxList = [ n in (0..#map) -> def result; (var result) ];

    for (mapping in map) {
        def id = get_value(mapping);
        boxList[id]* := get_key(mapping)
    };

    return [ box in boxList -> box* ]
};
