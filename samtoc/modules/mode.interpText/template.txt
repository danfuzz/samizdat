/*
 * GENERATED CODE!
 * GENERATED CODE!
 * GENERATED CODE!
 *
 * This code *may* be derived from a copyrighted source. Proceed with
 * caution!
 */

#include "type/List.h"
#include "type/Map.h"
#include "type/String.h"
#include "util.h"

static zvalue lookup(zvalue env, const char *name) {
    zvalue result = collGet(env, stringFromUtf8(-1, name));

    if (result == NULL) {
        die("Binding missing: %s", name);
    }

    return result;
}

zvalue eval(zvalue env) {
    zvalue moduleLoad = lookup(env, "moduleLoad");
    zvalue langModule = FUN_CALL(
        moduleLoad,
        listFromArgs(
            stringFromUtf8(-1, "core"),
            stringFromUtf8(-1, "Lang2"),
            NULL));
    zvalue parseProgramFn = lookup(langModule, "parseProgram");
    zvalue evalFn = lookup(langModule, "eval");

    zvalue progStr = stringFromUtf8(-1,
        \%q(source)
    );

    zvalue progTree = FUN_CALL(parseProgramFn, progStr);
    zvalue evalResult = FUN_CALL(evalFn, env, progTree);

    return evalResult;
}
