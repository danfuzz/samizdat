## Copyright 2013-2014 the Samizdat Authors (Dan Bornstein et alia).
## Licensed AS IS and WITHOUT WARRANTY under the Apache License,
## Version 2.0. Details: <http://www.apache.org/licenses/LICENSE-2.0>

##
## Box demo
##

#= language core.Lang0

import core.Box;


##
## Private Definitions
##

## Prints box info.
fn msg(box) {
    def str = ifValue { fetch(box) }
        { value -> $Format::source(value) }
        { "(void)" };

    note("Fetched: ", str)
};

## Prints box info using interpolation.
fn msgInterp(box) {
    def str = ifValue { box* }
        { value -> $Format::source(value) }
        { "(void)" };

    note("Interpolated: ", str)
};


##
## Main demos
##

note("Mutable Box");

def box1 = $Box::makeCell();
msg(box1);
box1.store();
msg(box1);
box1.store("Hi");
msg(box1);
box1.store("there!");
msg(box1);
box1.store();
msg(box1);

note("\nMutable Box, pre-set");

def box2 = $Box::makeCell("blort");
msg(box2);
box2.store();
msg(box2);
box2.store("igram");
msg(box2);

note("\nYield Box");

def box3 = $Box::makePromise();
msg(box3);
box3.store("fizmo");
msg(box3);

note("\nResult Box, void");

def box4 = $Box::makeResult();
msg(box4);

note("\nResult Box, value");

def box5 = $Box::makeResult("blort");
msg(box5);

note("\nnullBox");

msg(nullBox);
nullBox.store("stuff");
msg(nullBox);

note("\nInterpolation");

msgInterp(nullBox);
msgInterp($Box::makeCell());
msgInterp($Box::makeCell("blort"));
