## Copyright 2013-2014 the Samizdat Authors (Dan Bornstein et alia).
## Licensed AS IS and WITHOUT WARRANTY under the Apache License,
## Version 2.0. Details: <http://www.apache.org/licenses/LICENSE-2.0>

##
## Demo of value construction
##

#= language core.Lang0


##
## Private Definitions
##

## Expects the two values to be `eq`.
fn expectSame(v1, v2) {
    ifIs { eq(v1, v2) }
        { note("Yes.") }
        {
            die("Different: ",
                $Format::source(v1), ", ", $Format::source(v2))
        }
};

## Expects the two values to be `ne`.
fn expectDifferent(v1, v2) {
    ifIs { ne(v1, v2) }
        { note("Yes.") }
        { die("Same: ", $Format::source(v1)) }
};

## Expects the value to be a core value.
fn expectCore(v) {
    ifIs { Record.accepts(v) }
        { die("Record: ", $Format::source(v)) }
        { note("Yes.") }
};

## Expects the value to be a record.
fn expectRecord(v) {
    ifIs { Record.accepts(v) }
        { note("Yes.") }
        { die("Opaque: ", $Format::source(v)) }
};


##
## Main Tests
##
## Expect everything to be a "yes."
##


## String

note("\nString");

expectSame("", "");
expectSame("x", "x");
expectSame("blort", "blort");
expectSame("blort".cat("-fizmo", "-igram"), "blort-fizmo-igram");
expectSame("frotz".nth(4), "z");

expectDifferent("blort", "Blort");
expectDifferent("blort", "blort ");
expectDifferent("blort", "blort\0");

expectCore("");
expectCore("x");
expectCore("muffins");


## Function

note("\nFunction");

def fn1 = { x -> x };
def fn2 = { x -> x };

expectSame(fn1, fn1);
expectSame(fn2, fn2);
expectDifferent(fn1, fn2);
expectDifferent(fn2, fn1);
expectCore(fn1);
expectCore(fn2);


## Symbol

note("\nSymbols");

expectSame(@boo, @boo);
expectSame(@boo, @"boo");

expectCore(@boo);


## SymbolTable

note("\nSymbol Tables");

expectSame(@{}, @{});
expectSame(@{blort: "splort"}, @{@blort: "splort"});
expectDifferent(@{blort: "splort"}, @{blort: "zlort"});
expectDifferent(@{blort: "splort"}, @{zlort: "splort"});

expectSame(@{x: 10}, @{@{x: 10}*});
expectSame(@{x: 10, y: 20}, @{y: 20, @{x: 10}*});
expectSame(@{x: 10, y: 20}, @{x: 10}.put(@y, 20));
expectSame(@{x: 10, y: 20}, @{x: 10, y: 10}.put(@y, 20));

expectSame(@{x: 10}, @{x: 10}.del(@y));
expectSame(@{x: 10}, @{x: 10, y: 20}.del(@y));

expectCore(@{});
expectCore(@{blort: "splort"});


## Record

note("\nRecord");

expectSame(@eek{x: 10}, @(@eek){x: 10});
expectSame(@eek{x: 10}, @eek{x: (5).add(5)});
expectSame(@eek{x: 10}, @(cast(Symbol, "eek")){x: 10});

expectDifferent(@x{}, @x{a: 1});
expectDifferent(@x{a: 1}, @x{a: 2});
expectDifferent(@x{a: 1}, @y{a: 1});

expectSame(@blort, @blort{}.get_name());
expectSame(@{a: 1}, @blort{a: 1}.get_data());

expectRecord(@fizmo{});
