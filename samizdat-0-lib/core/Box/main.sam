# Copyright 2013 the Samizdat Authors (Dan Bornstein et alia).
# Licensed AS IS and WITHOUT WARRANTY under the Apache License,
# Version 2.0. Details: <http://www.apache.org/licenses/LICENSE-2.0>

#
# Box functions
#

def Box = moduleGet({name: ["proto", "Box"]});

def NullBox = submoduleUse("NullBox");


#
# Exported Definitions
#

# Documented in Samizdat Layer 0 spec.
fn update(box, updateFunction) {
    <> ifValue { <> Box_fetch(box) }
        { value <> Box_store(box, updateFunction(value)) }
        { <> Box_store(box, updateFunction()) }
};

<> {
    # Re-exported from proto.
    canStore:       Box::canStore,
    fetch:          Box::fetch,
    store:          Box::store,

    # Re-exported from `NullBox`.
    nullBox:        NullBox::nullBox,

    # Re-exported from primitive library.
    makeMutableBox: Box_makeMutableBox,
    makeYieldBox:   Box_makeYieldBox,

    # Defined in this file.
    update:         update
}
