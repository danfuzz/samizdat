## Copyright 2013-2014 the Samizdat Authors (Dan Bornstein et alia).
## Licensed AS IS and WITHOUT WARRANTY under the Apache License,
## Version 2.0. Details: <http://www.apache.org/licenses/LICENSE-2.0>

##
## Sequence functions
##

#= language core.Lang0

import proto.Number :: add, sub;

## Re-export. Documented in spec.
export import proto.Sequence :: *;



##
## Exported Definitions
##

## Documented in spec.
export fn nthFromEnd(seq, n) {
    def index = sub(seq.get_size(), add(n, 1));
    return? nth(seq, index)
};

## Documented in spec.
export fn sliceGeneral(seq, style, start, optEnd?) {
    def limit = sub(seq.get_size(), 1);
    def func = ifIs { eq(style, @exclusive) }
        { sliceExclusive }
        { sliceInclusive };
    def startIndex = ifIs { hasClass(start, @@fromStart) }
        { start::value }
        { sub(limit, start::value) };
    def optEndIndex = (ifValue { optEnd* }
        { end ->
            ifIs { hasClass(end, @@fromStart) }
                { end::value }
                { sub(limit, end::value) }
        })?;

    return? func(seq, startIndex, optEndIndex*)
};
