## Copyright 2013-2014 the Samizdat Authors (Dan Bornstein et alia).
## Licensed AS IS and WITHOUT WARRANTY under the Apache License,
## Version 2.0. Details: <http://www.apache.org/licenses/LICENSE-2.0>

##
## PEG (Parsing Expression Grammar) support
##

#= language core.Lang0

import core.Generator :: FilterGenerator;


##
## Exported Definitions
##

## Documented in spec.
export fn apply(rule, input) {
    def result;
    def generator = ifIs { String.accepts(input) }
        {
            ## This converts generated characters into tokens with the
            ## characters as the class name.
            FilterGenerator.new(input) { ch -> @(cast(Symbol, ch)){} }
        }
        { input };

    return? ifIs { rule.parse(result?, generator) }
        { result }
};

## Documented in spec.
export fn stringFromTokenList(tokens) {
    return "".cat((tokens.collect { t -> t.get_name() })*)
};

## Documented in spec.
export fn symbolFromTokenList(tokens) {
    return cast(Symbol, stringFromTokenList(tokens))
};
